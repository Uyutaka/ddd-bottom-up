## 1. ドメイン駆動設計とは何か？
専門家（ドメインのエキスパート）から知識を引き出す。
ドメインの専門家は高度な専門知識を持っているが、通常ソフトウェアシステムとして実装するには最適ではない。
ソフトウェアの設計者は分析的に考えることで、専門家の知識の概念を掘り出してモデル化、設計を行う。

ソフトウェアの目的は実際のドメインでの業務の問題を解決することだから、そのためにはソフトウェアはドメインと完璧に一体になる必要がある。

## 2. ユビキタス言語

ドメインの専門家は独自の専門用語を使う。技術チームは別の独自の専門用語を使う。
→ DD設計の核になる原則はドメインモデル（ソフトウェアとドメインがである場所）に基づく言語を使う。どんな形態のコミュニケーション(コード、文章、会話)でもこの言語を使う

## 3. モデル駆動設計

- より良い方法はドメインモデリング　と　設計を密接にすること

- ドメインモデルは次を満たす必要がある。1)設計との対応関係が明確なモデル 2) 自然にソフトウェアを実装できるモデル 3)ユビキタス言語が十分に使われていること



### レイヤアーキテクチャ

- 4つのレイヤー(UI, Application, Domain, Infrastructure)

1. UI... ユーザーに情報を表示、ユーザーの命令を解釈

2. Application... ビジネスロジックを含まない。ビジネスオブジェクトの状態を保持しない。しかしApplicationの処理の進み具合を保持することはある

3. Domain... 心臓部。ビジネスオブジェクトの状態を保持する。ビジネスオブジェクトの永続化をinfrastructureに委託する。まれにビジネスオブジェクトの状態もinfrastructureに委託することあり。

4. Infrastructure... 他のレイヤを補助するライブラリとして働く。レイヤ間n情報のやりとりを制御し、ビジネスオブジェクトの永続化を実装する。UIを補助するライブラリも含む。

### エンティティ

- 常に一意性のあるオブジェクト。エンティティの寿命はシステムを超えることもある。

### バリューオブジェクト
- バリューオブジェクトは不変で一意性を保持しない。
- バリューオブジェクトは変更できないようにするべき。
    - コンストラクタで作成された後、破棄されるまで変更できないようにする。

- ルール
    1. バリューオブジェクトが共有可能の時、変更不可能にする。
    2. バリューオブジェクトは小さくてシンプルなオブジェクトにすること
    3. 他のオブジェクトがバリューオブジェクトが必要なときは値を渡すかコピーを渡すこと。

### サービス

- EX:Q銀行の送金の処理は　送金元、送金先　どちらのオブジェクトにあるべきか？　 Aどちらにあるのも間違っている。(==サービスにする)

- サービスは操作を提供するインターフェイスとして働く。

- ドメインオブジェクトに「振る舞い」を持たせてはいけない。理由は、振る舞いをもつオブジェクトとそれを呼び出すオブジェクトが強く結びつくから
- サービスはレイヤードアーキの「アプリケーション」or「ドメイン」層に作成される
- サービスの特徴
    1. サービスとして作成される振る舞いはドメインの概念を表しているが、エンティティやバリューオブジェクトに含めると違和感がある
    2. サービスとして作成される操作はドメイン内の他のオブジェクトから参照される。
    3. サービスは状態を持たない

### モジュール

- モジュールにも高い凝集度と低い結合度を持たせるべき

### アグリゲート

- モデリングの難題に対処するためのパターン
    - アグリゲート...オブジェクトの所有権と境界を定義するのに使うパターン
    - ファクトリとレポジトリ...オブジェクトの作成と保管に役立つパターン
- アグリゲートは
    - 関連するオブジェクトの集まり
    - データの変更について一括して扱う
    - アグリゲートは一つのルート(entity)をもつ
    - アグリゲート内のオブジェクトは他のアグリゲートのルートの参照を保持しても良い
- ルートは
    - アグリゲート中のオブジェクトの参照を保持する。
    - アグリゲート外のオブジェクトはルートの参照しか保持できない
    - 不変性の保持に責任を持つ

### ファクトリ

- アグリゲートのルートのコンストラクタで構築できないほど複雑になった際はファクトリを使う

- ファクトリはオブジェクトの生成に必要な知識をカプセル化する。アグリゲートの作成にも利用可能

- ファクトリ実装の2パターン
    1. [factory method](https://refactoring.guru/design-patterns/factory-method)
        - 利用シーン：クライアントがアグリゲートに属するオブジェクトを生成したいとき。EX:ルートにメソッドを追加して、そのメソッドがオブジェクトを生成して不変性を維持しながら、作成したobjの参照やコピーを返す
    2. [abstract factory](https://refactoring.guru/design-patterns/abstract-factory)

### レポジトリパターン

- レポジトリはオブジェクトの参照を取得するロジックを全てカプセル化するパターン
- レポジトリのインターフェイスは完全にドメインモデルの要素になる
- ファクトリとレポジトリ
    - 両方ともドメインオブジェクトのライフサイクルを管理するのに役立つ
    - ファクトリはオブジェクトの生成管理
    - レポジトリは既存のオブジェクトの管理
